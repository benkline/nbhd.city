# nbhd.city

A collaborative community platform built on modern, serverless architecture: a React frontend for the UI, FastAPI backend for APIs, DynamoDB for storage, and AWS Lambda. Nbhds are on the AT Protocol serving as the Personal Data Server for its nbrs. Collaborate to create static sites using pre-built templates and uploaded 11ty templates. Nbhds utilize a plug-in system to add features for additional collaboration methods.

---

## Local Development Setup

### Prerequisites

- **Node.js** 18+ (for frontend)
- **Python** 3.11+ (for backend API)
- **pip** (Python package manager)

### Frontend Setup

The React frontend uses Vite as the build tool and runs on `http://localhost:5173`.

```bash
cd nbhd

# Install dependencies
npm install

# Start development server
npm run dev

# Run tests
npm test

# Run tests in watch mode
npm run test:watch

# Build for production
npm run build
```

**Key directories:**
- `src/pages/` - Main page components
- `src/components/` - Reusable UI components
- `src/__tests__/` - Component tests (Vitest)
- `src/styles/` - Global CSS

### API Setup

The FastAPI backend runs on `http://localhost:8000` and provides all REST endpoints.

```bash
cd api

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Start development server
uvicorn main:app --reload

# Run tests
pytest

# Run tests with coverage
pytest --cov
```

**Key files:**
- `main.py` - FastAPI app setup and route registration
- `models.py` - Pydantic models for request/response schemas
- `users/` - User authentication and profile endpoints
- `nbhds/` - Neighborhood management endpoints
- `templates.py` - Template discovery endpoints
- `sites/` - Site configuration and management endpoints

### Environment Variables

Create `.env` files in both `api/` and `nbhd/` directories:

**api/.env:**
```
# Server
PORT=8000
DEBUG=true

# Database (DynamoDB - optional for local dev)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret

# Authentication
JWT_SECRET=your-secret-key-here
BLUESKY_CLIENT_ID=your_client_id
BLUESKY_CLIENT_SECRET=your_client_secret
```

**nbhd/.env:**
```
# API endpoint for development
VITE_API_URL=http://localhost:8000
```

## Key Features (Phase 2)

### Static Site Generation
- **Template Gallery** - Browse pre-built 11ty templates (blog, project, newsletter)
- **Site Configuration** - Dynamic form based on template schema
- **Live Preview** - See changes instantly as you configure
- **One-Click Deployment** - Publish to `username.nbhd.city` with custom domain support
- **Site Management** - Edit, delete, and manage published sites
- **Plugin System for Addtional Features** - Shop for and add plugins giving each nbhd its own personality

## Testing

### Frontend Tests
```bash
cd nbhd
npm test                  # Run all tests
npm run test:watch        # Watch mode
npm run test:coverage     # Coverage report
```

Tests use Vitest + React Testing Library. Components are tested in isolation with mocked API calls.

### Backend Tests
```bash
cd api
pytest                   # Run all tests
pytest --cov             # With coverage
pytest -v                # Verbose output
```

Tests use pytest with async support for FastAPI endpoints.

---

## Architecture

The application follows a serverless architecture:

- **Frontend:** React SPA deployed to S3 + CloudFront
- **API:** FastAPI on AWS Lambda (with Mangum ASGI adapter)
- **Database:** DynamoDB for all data storage
- **Static Sites:** Generated by Lambda, stored in S3, served via CloudFront
- **Authentication:** BlueSky OAuth 2.0 â†’ JWT tokens

See `planning/ARCHITECTURE.md` for detailed system design.

## License

MIT
